{
  "name": "INTEGRAÇÃO ALPHA 7",
  "type": 2,
  "version": 1,
  "initialtext": "a40b650c0",
  "description": null,
  "listitems": "[]",
  "options": "[{\"id\":\"a91278fd0\",\"type\":12,\"x\":309,\"y\":40,\"info\":\"\",\"configured\":true,\"config\":{\"nextElementId\":\"a77e99660\",\"varPrefix\":\"respostaBD\",\"method\":\"post\",\"url\":\"http://{{ip_do_cliente}}:12537/bd/getOrcamento\",\"retrys\":0,\"timeout\":15000,\"dataType\":\"jsonraw\",\"numberFields\":[],\"data\":{},\"testData\":{},\"dataRaw\":\"{\\n   \\\"id\\\": \\\"{{clientNumber}}\\\",\\n   \\\"consulta\\\": \\\"with orcamentovalortotal as (select orcamento.id, sum(itemorcamento.valortotal) as total from orcamento join itemorcamento on itemorcamento.orcamentoid = orcamento.id join unidadenegocio on unidadenegocio.id = orcamento.unidadenegocioid where orcamento.status = '{{status}}' and orcamento.codigo = '{{orcamentoId}}' and unidadenegocio.codigo = '{{filial}}' group by 1) select orcamento.status as status, unidadenegocio.codigo as filial, orcamento.codigo as id, orcamentovalortotal.total as valortotal, embalagem.descricao, itemorcamento.quantidade,  itemorcamento.valortotal from orcamento join itemorcamento on itemorcamento.orcamentoid = orcamento.id join embalagem on embalagem.id = itemorcamento.embalagemid join unidadenegocio on unidadenegocio.id = orcamento.unidadenegocioid join orcamentovalortotal on orcamentovalortotal.id = orcamento.id where orcamento.status = '{{status}}' and orcamento.codigo = '{{orcamentoId}}' and unidadenegocio.codigo = '{{filial}}'\\\"\\n}\",\"headers\":{\"Authorization\":\"{{Authorization}}\"},\"testHeaders\":{\"Authorization\":\"{{Authorization}}\"},\"expectedContentType\":0,\"textPreProcessor\":0,\"textPreProcessorSeparator\":\"\",\"textPostProcessorSeparator\":\"\",\"textResponseVariable\":\"\"}},{\"id\":\"a77e99660\",\"type\":11,\"x\":185,\"y\":189,\"info\":\"\",\"configured\":true,\"config\":{\"nextElementId\":\"a36d5ee20\",\"value\":\"{{respostaBD_httpStatus}}\",\"options\":[{\"id\":\"a7fb956e0\",\"conditionOperator\":\"=\",\"conditionValue\":\"Nova condição\",\"conditionArray\":[\"200\",\"201\"],\"nextElementId\":\"a91e940f0\"}]}},{\"id\":\"adcf29bb0\",\"type\":3,\"x\":805,\"y\":189,\"info\":\"\",\"configured\":true,\"config\":{\"nextElementId\":\"\",\"text\":\"Um erro ocorreu.\\n\\nErro: {{respostaBD_rawBody.errorMessage}}\",\"fileChooseType\":0,\"fileId\":\"\"}},{\"id\":\"a3254f9e0\",\"type\":3,\"x\":977,\"y\":261,\"info\":\"\",\"configured\":true,\"config\":{\"nextElementId\":\"\",\"text\":\"{{respostaBD.message}}\\n\\n{{clientName}} segue sua solicitação:\\nORÇAMENTO Nº {{orcamentoId}}\\n\\n{{respostaFinalAlpha}}\\n\\nTotal: {{valorTotalAlpha}}\\n\\nOrçamento válido por 7 dias.\\nAgradecemos e aguardamos sua aprovação! \\n\\nAtenciosamente,\\nEquipe de Atendimento {{nome_da_empresa}}.\",\"fileChooseType\":0,\"fileId\":\"\"}},{\"id\":\"a36d5ee20\",\"type\":30,\"x\":623,\"y\":189,\"info\":\"\",\"configured\":true,\"config\":{\"nextElementId\":\"adcf29bb0\",\"searchField\":\"clientNumber\",\"searchValue\":\"{{respostaBD.id}}\"}},{\"id\":\"a91e940f0\",\"type\":30,\"x\":614,\"y\":261,\"info\":\"\",\"configured\":true,\"config\":{\"nextElementId\":\"aec686ae0\",\"searchField\":\"clientNumber\",\"searchValue\":\"{{respostaBD.id}}\"}},{\"id\":\"aec686ae0\",\"type\":21,\"x\":795,\"y\":261,\"info\":\"\",\"configured\":true,\"config\":{\"nextElementId\":\"a3254f9e0\",\"code\":\"let dados = vars['respostaBD_rawBody'];\\r\\n\\r\\nvar convertMoeda = Intl.NumberFormat('pt-br', {\\r\\n    style: 'currency',\\r\\n    currency: 'BRL'\\r\\n});\\r\\n\\r\\nlet consultaAlpha = dados.itens;\\r\\nlet arrumaResposta = '';\\r\\nvars['somaTotal'] = 0;\\r\\nlet descontoTot = 0;\\r\\n\\r\\nfor(i = 0; i < consultaAlpha.length; i++){\\r\\n    vars['desc'] = consultaAlpha[i].descricao;\\r\\n    vars['quant'] = consultaAlpha[i].quantidade.split('.')[0];\\r\\n\\r\\n    let valorItem = parseFloat(consultaAlpha[i].valortotal);\\r\\n    vars['valorItem'] = valorItem.toFixed(2);\\r\\n\\r\\n    vars['somaTotal'] += valorItem;\\r\\n\\r\\n    arrumaResposta = arrumaResposta + `${vars['desc']} x ${vars['quant']} = ${convertMoeda.format(valorItem)}` + \\\"\\\\n\\\";\\r\\n}\\r\\n\\r\\nvars['respostaFinalAlpha'] = arrumaResposta;\\r\\nvars['valorTotalAlpha'] = convertMoeda.format(Number(vars['somaTotal']));\\r\\n\\r\\n\"}},{\"id\":\"a40b650c0\",\"type\":21,\"x\":128,\"y\":40,\"info\":\"\",\"configured\":true,\"config\":{\"nextElementId\":\"a91278fd0\",\"code\":\"// Escreva seu código\\r\\nlet statusLetra = '';\\r\\n\\r\\nswitch(vars['orcamentoStatus']){\\r\\n    case 'Cotação/Aberto': \\r\\n       statusLetra = 'A'\\r\\n       break\\r\\n    case 'Confirmado': \\r\\n       statusLetra = 'B'\\r\\n       break\\r\\n    case 'Finalizado':\\r\\n       statusLetra = 'C'\\r\\n       break\\r\\n    case 'Cancelado': \\r\\n       statusLetra = 'D'\\r\\n       break\\r\\n}\\r\\n\\r\\nvars['status'] = statusLetra;\"}},{\"id\":\"a3ca7d6a0\",\"type\":21,\"x\":764,\"y\":323,\"info\":\"\",\"configured\":true,\"config\":{\"nextElementId\":\"\",\"code\":\"let dados = vars['respostaBD_rawBody'];\\r\\n\\r\\nvars['dados2'] = vars['respostaBD_parsedBody'];\\r\\n\\r\\nvars['dados3'] = vars['respostaBD.itens'];\\r\\n\\r\\nvar convertMoeda = Intl.NumberFormat('pt-br', {\\r\\n    style: 'currency',\\r\\n    currency: 'BRL'\\r\\n});\\r\\n\\r\\nvars['consultaAlpha'] = dados.itens;\\r\\nlet arrumaResposta = '';\\r\\nlet somaTotal = 0;\\r\\n\\r\\nfor(i=0; i<consultaAlpha.length; i++){\\r\\n    let descricao = consultaAlpha[i].descricao;\\r\\n    descricao = descricao[0].toUpperCase() + descricao.substring(1).toLowerCase();\\r\\n    let qtdItem = consultaAlpha[i].quantidade.split('.')[0];\\r\\n    let valorItem = Number(consultaAlpha[i].valortotal).toFixed(2);\\r\\n    somaTotal =  somaTotal + Number(valorItem);\\r\\n    arrumaResposta = arrumaResposta + `${descricao} x ${qtdItem} = ${convertMoeda.format(valorItem)}` + \\\"\\\\n\\\";\\r\\n}\\r\\n\\r\\nvars['respostaFinalAlpha'] = arrumaResposta;\\r\\nvars['valorTotalAlpha'] = convertMoeda.format(somaTotal);\"}},{\"id\":\"ad3a8f450\",\"type\":12,\"x\":119,\"y\":644,\"info\":\"\",\"configured\":true,\"config\":{\"nextElementId\":\"\",\"varPrefix\":\"a\",\"method\":\"post\",\"url\":\".\",\"retrys\":0,\"timeout\":15000,\"dataType\":\"jsonraw\",\"numberFields\":[],\"data\":{},\"testData\":{},\"dataRaw\":\"{\\n   \\\"id\\\": \\\"{{clientNumber}}\\\",\\n   \\\"consulta\\\": \\\"with orcamentovalortotal as (select orcamento.id, sum(itemorcamento.valortotal) as total from orcamento join itemorcamento on itemorcamento.orcamentoid = orcamento.id join unidadenegocio on unidadenegocio.id = orcamento.unidadenegocioid where orcamento.status = '{{status}}' and orcamento.codigo = '{{orcamentoId}}' and unidadenegocio.codigo = '{{filial}}' group by 1) select orcamento.status as status, unidadenegocio.codigo as filial, orcamento.codigo as id, orcamentovalortotal.total as valortotal, embalagem.descricao, itemorcamento.quantidade, itemorcamento.valortotal, itemorcamento.precovenda, itemorcamento.desconto from orcamento join itemorcamento on itemorcamento.orcamentoid = orcamento.id join embalagem on embalagem.id = itemorcamento.embalagemid join unidadenegocio on unidadenegocio.id = orcamento.unidadenegocioid join orcamentovalortotal on orcamentovalortotal.id = orcamento.id where orcamento.status = '{{status}}' and orcamento.codigo = '{{orcamentoId}}' and unidadenegocio.codigo = '{{filial}}'\\\"\\n}\",\"headers\":{},\"testHeaders\":{},\"expectedContentType\":0,\"textPreProcessor\":0,\"textPreProcessorSeparator\":\"\",\"textPostProcessorSeparator\":\"\",\"textResponseVariable\":\"\"}}]",
  "finishtext": "",
  "fk_visualgroup": 0,
  "timeouttags": "[]",
  "notfoundtext": null,
  "allowagentstart": 1,
  "executionwithoutconfirmation": 0,
  "allowcontactexecution": 0,
  "allowopportunityfileexecution": 0,
  "allowtaskfileexecution": 0,
  "allowmsgexecution": 0,
  "waitmsgaiprocess": 0,
  "audiomsg": 0,
  "videomsg": 0,
  "locationmsg": 0,
  "textmsg": 0,
  "allowopportunity": 0,
  "pdfmsg": 0,
  "informationmsg": 0,
  "imagemsg": 0,
  "allmsgs": 0,
  "requestdataform": 1,
  "timeout": 600,
  "timeoutaction": 0,
  "buttons": "[{\"name\":\"Número do Orçamento\",\"var\":\"orcamentoId\",\"type\":1,\"importd\":true,\"options\":[]},{\"name\":\"Filial\",\"var\":\"filial\",\"type\":1,\"importd\":true,\"options\":[]},{\"name\":\"Status do Orçamento\",\"var\":\"orcamentoStatus\",\"type\":4,\"importd\":true,\"options\":[\"Cotação/Aberto\",\"Confirmado\",\"Finalizado\"]}]"
}
